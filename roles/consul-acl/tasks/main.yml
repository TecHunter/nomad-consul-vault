---
- name: Ensure Consul is in a running state
  service:
    name: consul
    state: started
  register: consulServiceDetails
  until: consulServiceDetails.status.ActiveState == "active"
  retries: 15
  delay: 20

- name: Create policies
  include_tasks: write-policies.yml
  vars:
    acl_name: "{{ item.key }}"
    acl_desc: "{{ item.value }}"
  with_dict:
    node:  "Node Token"
    nomad: "Nomad Service Token"
    vault: "Vault Service Token"
    traefik: "Traefik Catalog Service Token"

